#ifndef GAME_H
#define GAME_H

enum MouseStates {
    UP,
    DOWN,
    SHIFTDOWN,
    DOWNONBUTTON
};

static constexpr int WINDOW_WIDTH = 256;
static constexpr int WINDOW_HEIGHT = 224;
static constexpr int WINDOW_SCALE = 3;
static constexpr int TILE_SIZE = 8;
static constexpr int GRID_WIDTH = 14;
static constexpr int GRID_HEIGHT = 9;
static constexpr int GRID_X = 2;
static constexpr int GRID_Y = 8;
static constexpr unsigned char digitTiles[10][4][2] = {
    {
        {15, 16},
        { 5, 19},
        { 9, 22},
        {26, 27}
    },
    {
        { 1, 17},
        { 6, 19},
        {10, 22},
        {12, 28}
    },
    {
        {18, 16},
        { 7, 20},
        {23, 11},
        {26, 13}
    },
    {
        {18, 16},
        { 7, 20},
        {24, 25},
        {14, 27}
    },
    {
        { 2, 17},
        {21, 20},
        {24, 25},
        {12, 28}
    },
    {
        { 3,  4},
        {21,  8},
        {24, 25},
        {14, 27}
    },
    {
        { 3,  4},
        {21,  8},
        {23, 25},
        {26, 27}
    },
    {
        {18, 16},
        { 6, 19},
        {10, 22},
        {12, 28}
    },
    {
        {15, 16},
        {21, 20},
        {23, 25},
        {26, 27}
    },
    {
        {15, 16},
        {21, 20},
        {24, 25},
        {14, 27}
    }
};

void InitGame();
void InitGrid();
void UpdateGame();
void DrawGame();
void DrawToScreen();
void DrawBackground();
void CheckMouseInput();
void OpenTile(int x, int y);
void DrawMario();
void CheckGameState();
void UpdateMineCount();
void DrawDigit(int x, int y, int digit);
void UpdateTime();
void UpdateTimeDisplay();

static RenderTexture2D target;
static RenderTexture2D inverted;
static Texture2D bgTileset;
static Texture2D marioTexture;
static Vector2 renderPosition;
static unsigned char nametable[WINDOW_HEIGHT / TILE_SIZE][WINDOW_WIDTH / TILE_SIZE] =
 {
    {  29,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  30,  31},
    {  32,  33,  34,  34,  34,  34,  34,  34,  35,  36,  36,  36,  36,  37,  38,  38,  38,  38,  36,  36,  36,  36,  36,  39,  34,  34,  34,  34,  34,  34,  40,  41},
    {  32,  42,   0,   0,   0,   0,   0,   0,  43,  44,  44,  44,  44,  32,  45,  46,  46,  47,  48,  44,  44,  44,  44,  49,   0,   0,   0,   0,   0,   0,  50,  41},
    {  32,  42,   0,   0,   0,   0,   0,   0,  43,  44,  44,  44,  44,  32,  51,  44,  44,  52,  48,  44,  44,  44,  44,  49,   0,   0,   0,   0,   0,   0,  50,  41},
    {  32,  42,   0,   0,   0,   0,   0,   0,  43,  44,  44,  44,  44,  32,  51,  44,  44,  52,  48,  44,  44,  44,  44,  49,   0,   0,   0,   0,   0,   0,  50,  41},
    {  32,  42,   0,   0,   0,   0,   0,   0,  43,  44,  44,  44,  44,  32,  53,  54,  54,  55,  48,  44,  44,  44,  44,  49,   0,   0,   0,   0,   0,   0,  50,  41},
    {  32,  59,  60,  60,  60,  60,  60,  60,  61,  62,  62,  62,  62,  62,  63,  63,  63,  63,  64,  62,  62,  62,  62,  65,  60,  60,  60,  60,  60,  60,  66,  41},
    {  67,  68,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  69,  70,  71},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  49,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  43,  44},
    {  44,  72,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  73,  74,  44},
    {  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44,  44}
};

static unsigned char grid[GRID_HEIGHT][GRID_WIDTH];
static int numMines;
static MouseStates mouseState;
static int mouseDownX;
static int mouseDownY;
static bool gameOver;
static bool gameWon;
static bool gameStarted;
static bool hoveringOnButton;
static int openedTiles;
static int numFlags;
static int secondsElapsed;
static double startTime;

#endif